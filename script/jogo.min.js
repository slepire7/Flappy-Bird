var Storage,Config,Service,Game,Jogo;!function(a){a.Set=function(a,t){localStorage.setItem(a,JSON.stringify(t))},a.Get=function(a){return(a=localStorage.getItem(a))?JSON.parse(a):""}}(Storage=Storage||{}),function(a){(a.Constant||(a.Constant={})).API={Atualizar:"https://flappybirdapi.azurewebsites.net/api/Put?code=9MNUOUmKKqCavdFrMwWBDPCPzV5jduvpV3PQAEWVMqTuAzFuARgB6A==",Criar:"https://flappybirdapi.azurewebsites.net/api/Post?code=P7gtMsQyyVYhGGeoFjFHqYyHcE-IJOF4WSnzfKjpx-ikAzFu3oVfjw==",Listar:"https://flappybirdapi.azurewebsites.net/api/Get?code=97ZirDQdmfpy4V8o4HSGP31IzHS9zBp8uGv6X-rAgq05AzFuALUcNA=="}}(Config=Config||{}),function(t){t.canvas=document.querySelector("canvas"),t.contexto=t.canvas.getContext("2d"),t.frames=0,t.KeyNameStorage={lastPoint:"FlappyBird1.0Lp",bestPoint:"FlappyBird1.0bp",currentPoint:"FlappyBird1.0cp",nickName:"FlappyBird_nickname"};const a=["localhost","127.0.0.1"].includes(window.location.hostname);t.TrilhasSonoras={HIT:()=>new Audio(`${0==a?"../Flappy-Bird/":"../"}assets/efeitos/hit.wav`),PULO:()=>new Audio(`${0==a?"../Flappy-Bird/":"../"}assets/efeitos/pulo.wav`),CAIU:()=>new Audio(`${0==a?"../Flappy-Bird/":"../"}assets/efeitos/caiu.wav`),PONTO:()=>new Audio(`${0==a?"../Flappy-Bird/":"../"}assets/efeitos/ponto.wav`)},t.sprites=new Image,t.sprites.src=`${0==a?"../Flappy-Bird/":"../"}assets/texture/sprites.png`,t.Draw=a=>{t.contexto.drawImage(t.sprites,a.spriteX,a.spriteY,a.largura,a.altura,a.x,a.y,a.largura,a.altura)},t.fazColisao=function(a,t){return a=a.y+a.altura,t.y<=a}}(Config=Config||{}),function(a){var t;(t=a.Method||(a.Method={})).randomIntFromInterval=function(a,t){return Math.floor(Math.random()*(t-a+1)+a)},t.ClearMemory=function(){a.frames=0,Storage.Set(a.KeyNameStorage.currentPoint,0)}}(Config=Config||{});class FlappyBird{frameAtual=0;spriteX=0;spriteY=0;largura=33;altura=24;x=10;y=50;gravidade=.25;velocidade=0;pulo=4;pula(){Config.TrilhasSonoras.PULO().play(),this.velocidade=-this.pulo}movimentos=[{spriteX:0,spriteY:0},{spriteX:0,spriteY:26},{spriteX:0,spriteY:52},{spriteX:0,spriteY:26}];atualizaOFrameAtual(){var a,t;Config.frames%10==0&&(a=1+this.frameAtual,t=this.movimentos.length,this.frameAtual=a%t)}desenha=()=>{this.atualizaOFrameAtual();var{spriteX:a,spriteY:t}=this.movimentos[this.frameAtual];Config.Draw({spriteX:a,spriteY:t,altura:this.altura,largura:this.largura,x:this.x,y:this.y})};atualiza(a,t){Config.fazColisao(this,t.chao)?(Config.TrilhasSonoras.CAIU().play(),a()):(this.velocidade=this.velocidade+this.gravidade,this.y=this.y+this.velocidade)}}class Chao{spriteX;spriteY;largura;altura;x;y;constructor(){this.spriteX=0,this.spriteY=610,this.largura=224,this.altura=112,this.x=0,this.y=Config.canvas.height-112}atualiza(){var a=this.largura/2,t=this.x-1;this.x=t%a}desenha(){Config.Draw({spriteX:this.spriteX,spriteY:this.spriteY,largura:this.largura,altura:this.altura,x:this.x,y:this.y}),Config.Draw({spriteX:this.spriteX,spriteY:this.spriteY,largura:this.largura,altura:this.altura,x:this.x+this.largura,y:this.y})}}class Cano{largura;altura;espaco;chao;ceu;pares;constructor(){this.largura=52,this.altura=400,this.espaco=90,this.chao={spriteX:0,spriteY:169},this.ceu={spriteX:52,spriteY:169},this.pares=[]}desenha(){this.pares.forEach(a=>{var t=a.y,e=a.x,i=t,r=(Config.Draw({spriteX:this.ceu.spriteX,spriteY:this.ceu.spriteY,largura:this.largura,altura:this.altura,x:e,y:i}),a.x),t=this.altura+this.espaco+t;Config.Draw({spriteX:this.chao.spriteX,spriteY:this.chao.spriteY,largura:this.largura,altura:this.altura,x:r,y:t}),a.canoCeu={x:e,y:this.altura+i},a.canoChao={x:r,y:t}})}temColisaoComOFlappyBird(a,t){var e=t.y-2,i=t.y+t.altura-2;return t.x+t.largura>=a.x&&(e<=a.canoCeu.y-2||i>=a.canoChao.y)}atualiza(a,t,e){var i,r=intervaloFrames[Config.Method.randomIntFromInterval(0,intervaloFrames.length-1)];Config.frames%r==0&&this.pares.push({x:Config.canvas.width,y:-150*(Math.random()+1)});for(i of this.pares){var s=Storage.Get(Config.KeyNameStorage.currentPoint)||0;i.x=i.x-Velocidades.dispach(s),this.temColisaoComOFlappyBird(i,t)&&(Config.TrilhasSonoras.HIT().play(),a()),i.x+this.largura<=0&&(this.pares.shift(),e.atualiza())}}}const intervaloFrames=[150],dificuldade_velocidade={20:2,40:2.5,80:4,100:4.5,110:5,120:6,130:7,140:8,150:9,200:10},Velocidades={dispach:t=>{var a=Object.keys(dificuldade_velocidade).map(a=>new Number(a)),a=a.find(a=>t<=a)||a[a.length-1];return dificuldade_velocidade[a]}};class PlanoDeFundo{spriteX;spriteY;largura;altura;x;y;constructor(){this.spriteX=390,this.spriteY=0,this.largura=275,this.altura=204,this.x=0,this.y=Config.canvas.height-204}desenha(){Config.contexto.fillStyle="#70c5ce",Config.contexto.fillRect(0,0,Config.canvas.width,Config.canvas.height),Config.Draw({spriteX:this.spriteX,spriteY:this.spriteY,largura:this.largura,altura:this.altura,x:this.x,y:this.y}),Config.Draw({spriteX:this.spriteX,spriteY:this.spriteY,largura:this.largura,altura:this.altura,x:this.x+this.largura,y:this.y})}atualiza(){}}!function(a){a.HttpService=class{static ListarPontuacao(){let a=[];const t=new XMLHttpRequest;return t.open("GET",Config.Constant.API.Listar,!1),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=function(){4===this.readyState&&(t.onreadystatechange=null,200===this.status?a=JSON.parse(this.response):console.log(this.responseText))},t.send(),a}static AtualizaPontuacao(){const a=new XMLHttpRequest;a.open("PUT",Config.Constant.API.Listar,!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){4===this.readyState&&(a.onreadystatechange=null)};var t={nick:Storage.Get(Config.KeyNameStorage.nickName),point:Storage.Get(Config.KeyNameStorage.bestPoint)};a.send(JSON.stringify(t))}static CriarPontuacao(){const a=new XMLHttpRequest;a.open("POST",Config.Constant.API.Listar,!0),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=function(){4===this.readyState&&(a.onreadystatechange=null)};var t={nick:Storage.Get(Config.KeyNameStorage.nickName),point:Storage.Get(Config.KeyNameStorage.bestPoint)||0};a.send(JSON.stringify(t))}}}(Service=Service||{});class Placar{pontuacao=0;desenha(){Config.contexto.font='35px "VT323"',Config.contexto.textAlign="right",Config.contexto.fillStyle="white",Config.contexto.fillText(""+this.pontuacao,Config.canvas.width-10,35),Storage.Set(Config.KeyNameStorage.lastPoint,this.pontuacao),Storage.Get(Config.KeyNameStorage.bestPoint)<Storage.Get(Config.KeyNameStorage.lastPoint)&&(Storage.Set(Config.KeyNameStorage.bestPoint,this.pontuacao),Service.HttpService.AtualizaPontuacao())}atualiza(){Config.TrilhasSonoras.PONTO().play(),this.pontuacao=this.pontuacao+1,Storage.Set(Config.KeyNameStorage.currentPoint,this.pontuacao)}}class MainScoreGame{none;bronze;prata;ouro;constructor(){var a=Config.canvas.width/2/2.4;this.none=new Score(0,78,44,44,a,135),this.bronze=new Score(48,124,44,44,a,135),this.prata=new Score(48,78,44,44,a,135),this.ouro=new Score(0,124,44,44,a,135)}desenha(){var a=Storage.Get(Config.KeyNameStorage.lastPoint),t=Storage.Get(Config.KeyNameStorage.bestPoint),e=Config.canvas.width/3*2.4,i=Config.canvas.width/3*1.9;Config.contexto.fillText(""+a,e,147),Config.contexto.fillText(""+t,e,i),a<50?this.none.desenha():a<=100?this.bronze.desenha():a<=150?this.prata.desenha():200<=a&&this.ouro.desenha()}}class Score{constructor(a,t,e,i,r,s){this.spriteX=a,this.spriteY=t,this.largura=e,this.altura=i,this.x=r,this.y=s}desenha(){Config.Draw({spriteX:this.spriteX,spriteY:this.spriteY,largura:this.largura,altura:this.altura,x:this.x,y:this.y})}spriteX;spriteY;largura;altura;x;y}!function(a){{var t=a.Main||(a.Main={});const r={};function e(a){t.TelaAtiva=a,t.TelaAtiva.inicializa()}function i(a){return()=>{t.TelaAtiva=a,t.TelaAtiva.inicializa()}}t.Telas={INICIO:{inicializa(){r.flappyBird=new FlappyBird,r.chao=new Chao,r.canos=new Cano},desenha(){(new PlanoDeFundo).desenha(),r.flappyBird.desenha(),r.chao.desenha(),s.desenha()},click(){e(t.Telas.JOGO)},atualiza(){r.chao.atualiza()}},JOGO:{inicializa(){r.placar=new Placar},desenha(){(new PlanoDeFundo).desenha(),r.canos.desenha(),r.chao.desenha(),r.flappyBird.desenha(),r.placar.desenha()},click(){r.flappyBird.pula()},atualiza(){r.canos.atualiza(i(t.Telas.GAME_OVER),r.flappyBird,r.placar),r.chao.atualiza(),r.flappyBird.atualiza(i(t.Telas.GAME_OVER),r)}},GAME_OVER:{inicializa(){},desenha(){n.desenha&&n.desenha(),(new MainScoreGame).desenha()},atualiza(){},click(){e(t.Telas.INICIO)}}},t.mudaParaTela=e,t.TelaCondicional=i,t.TelaAtiva={click:()=>{},atualiza:()=>{},desenha:()=>{},inicializa:()=>{}};const s={spriteX:134,spriteY:0,largura:174,altura:152,x:Config.canvas.width/2-87,y:50,desenha(){Config.Draw({spriteX:s.spriteX,spriteY:s.spriteY,largura:s.largura,altura:s.altura,x:s.x,y:s.y})}},n={spriteX:134,spriteY:153,largura:226,altura:200,x:Config.canvas.width/2-113,y:50,desenha(){Config.Draw({spriteX:n.spriteX,spriteY:n.spriteY,largura:n.largura,altura:n.altura,x:n.x,y:n.y}),Config.Method.ClearMemory()}}}}(Game=Game||{}),function(a){function t(){var a=Service.HttpService.ListarPontuacao();console.log(a);const i=document.querySelector("#list-placar");i.innerHTML="",a.map((a,t)=>{var e=document.createElement("li");e.className="list-group-item",e.innerText=`${t+1}ยบ ${a.nick} - `+a.point,i.appendChild(e)})}function e(){Game.Main.TelaAtiva.desenha(),Game.Main.TelaAtiva.atualiza(),Config.frames+=1,requestAnimationFrame(e)}(a=a.PageEvents||(a.PageEvents={})).CarregarPlacar=t,a.Main=function(){document.getElementById("game-canvas").addEventListener("click",function(){if(""==Storage.Get(Config.KeyNameStorage.nickName)){{let a,t;for(;t=prompt("digite um usuario"),a=confirm(`usuario escolhido :${t} correto?`),0==a;);Storage.Set(Config.KeyNameStorage.nickName,t)}Service.HttpService.CriarPontuacao()}Game.Main.TelaAtiva.click&&Game.Main.TelaAtiva.click()}),window.addEventListener("keypress",function(a){Game.Main.TelaAtiva.click&&Game.Main.TelaAtiva.click()}),document.querySelector("#pills-placar-tab").addEventListener("click",function(){t()}),Game.Main.mudaParaTela(Game.Main.Telas.INICIO),e()}}(Jogo=Jogo||{}),Jogo.PageEvents.Main();